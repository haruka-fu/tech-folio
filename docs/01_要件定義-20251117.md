# Tech Folio ポートフォリオ管理システム 要件定義書（最終版）

## 1. システム概要

利用者が自身のプロジェクト実績・使用技術・担当役割を整理するための
**個人向けポートフォリオ管理ダッシュボード**を提供する。

エンジニアが自身のスキルセットを可視化し、プロジェクト実績を効果的に管理できるツール。

MVPでは公開ページ機能は実装しない。
認証済ユーザーのみが利用する非公開システムとする。

---

## 2. 利用想定・制約

### 2.1 システム規模

* 利用者数：個人利用（将来的に10〜100名程度に拡張可能）
* データ量：1ユーザーあたりプロジェクト100件程度

### 2.2 技術スタック

* **ホスティング**: Vercel
* **フロントエンド**: Next.js 16.0.3（App Router）
* **言語**: TypeScript
* **データベース**: Supabase PostgreSQL
* **認証**: Google / GitHub / Qiita OAuth
* **スタイリング**: Tailwind CSS
* **アイコン**: Material Symbols Outlined

---

## 3. 機能要件

### 3.1 認証機能

#### 3.1.1 ログイン

* **対応プロバイダー**: Google / GitHub / Qiita
* **複数プロバイダー対応**: 1つのアカウントに最大3つの認証方法を連携可能
* **プライマリー認証**: 最初に連携したプロバイダーが自動的にプライマリーとなる
* **セッション管理**: トークンはDBに保存せず、セッションのみで管理（セキュリティ向上）

#### 3.1.2 初回登録

* 初回ログイン時に `profiles` テーブルにレコードを自動生成
* `user_id` の設定を必須とする
  * 英数字 4〜20 文字
  * 重複チェックあり（変更時にリアルタイムで確認）
  * 何回でも変更可能
* `email` はプライマリー認証プロバイダーから自動取得

#### 3.1.3 認証プロバイダー管理

* 連携済みプロバイダー一覧の表示
* 新しいプロバイダーの追加連携
* プロバイダーの連携解除
  * プライマリー認証は削除不可
  * 最低1つの認証方法は必須

---

### 3.2 プロフィール管理

#### 3.2.1 編集可能項目

**基本情報**:

* `user_id`: ユーザーID（4〜20文字の英数字、何回でも変更可能、重複チェック付き）
* `display_name`: 表示名（必須、空文字禁止）
* `email`: メールアドレス（プライマリー認証から自動取得、表示のみ）
* `bio`: 自己紹介文
* `avatar_url`: プロフィール画像のURL

**SNSリンク**（全て手動入力、`https://` または `http://` のみ許可）:

* `github_url`: GitHubプロフィールURL
* `twitter_url`: TwitterプロフィールURL
* `qiita_url`: QiitaプロフィールURL
* `other_url`: その他のURL（個人サイトなど）

#### 3.2.2 user_id 変更仕様

* 変更回数の制限: なし（何回でも変更可能）
* 変更時の処理:
  1. 新しい user_id の重複チェック（既に使用されている場合はエラー表示）
  2. 重複がない場合のみ更新を実行
  3. 更新成功後、`user_id_change_count` をインクリメント（変更履歴の記録用）

#### 3.2.3 プロフィール画像

* 対応形式: PNG / JPG / JPEG
* ファイルサイズ: 最大 2MB
* 保存方法: Supabase Storage（上書き保存、旧画像は削除）

---

### 3.3 プロジェクト管理

#### 3.3.1 プロジェクト項目

**必須項目**:

* `title`: プロジェクト名（空文字禁止）
* `summary`: プロジェクト概要（空文字禁止）
* `description`: 詳細説明（空文字禁止）
* `period_start`: プロジェクト開始日（DATE型）

**オプション項目**:

* `period_end`: プロジェクト終了日（NULL の場合は進行中）
* `is_current`: 現在進行中かどうか（BOOLEAN）
* `roles`: 担当役割（INTEGER配列、rolesテーブルのIDを参照）
* タグ: 技術タグ（project_tags テーブルで多対多関連）

#### 3.3.2 役割（Roles）

**固定マスターデータ**（全ユーザー共通、カスタマイズ不可）:

1. 要件定義
2. 基本設計
3. 詳細設計
4. 開発
5. テスト
6. 運用

プロジェクトの `roles` カラムに配列として保存（例: `[1, 3, 4]`）

#### 3.3.3 技術タグ

* タグ名は重複不可（UNIQUE制約）
* `category` でカテゴリ分類可能（例: "Frontend", "Backend", "DevOps"）
* `color` で表示色を設定可能（16進数カラーコード形式）
* 設定画面で追加・編集・削除可能
* プロジェクトで使用中のタグは削除時に警告

#### 3.3.4 プロジェクト一覧表示

* **ページネーション**: 20件ずつ表示
* **ソート機能**:
  * 開始日降順（デフォルト）
  * タイトル昇順
  * タイトル降順
* **フィルタリング機能**:
  * 技術タグでフィルタ
  * 役割でフィルタ
  * 検索クエリ（title/summary）

#### 3.3.5 CRUD操作

* **作成**: モーダル形式で新規プロジェクトを登録
* **読取**: プロジェクト詳細画面で全情報を表示
* **更新**: 既存プロジェクトの編集
* **削除**: 物理削除（論理削除ではない）

---

### 3.4 スキル統計機能

#### 3.4.1 集計方法

* `project_tags` テーブルからリアルタイム集計
* キャッシュテーブルは使用しない（シンプルさを優先）
* 各タグの使用回数をカウント

#### 3.4.2 表示形式

**プロフィールビュー**:

* 基本情報とスキルサマリー（棒グラフ）

**ダッシュボードビュー**:

* グリッドレイアウトでスキル統計を表示
  * モバイル: 2列
  * タブレット: 3列
  * デスクトップ: 4列
* 上位スキルに視覚的な強調（透明度による階層表現）

---

### 3.5 設定画面

#### 3.5.1 機能一覧

1. **プロフィール編集**
   * user_id、表示名、自己紹介、SNSリンクの編集
   * プロフィール画像のアップロード

2. **user_id 変更**
   * 重複チェック（既に使用されている場合はエラー表示）
   * リアルタイムバリデーション

3. **技術タグ管理**
   * タグの追加・編集・削除
   * カテゴリ・カラーの設定
   * 使用中タグの削除防止

4. **認証プロバイダー管理**
   * 連携済みプロバイダーの一覧表示
   * 新規プロバイダーの追加連携
   * プロバイダーの連携解除（プライマリーは削除不可）

---

## 4. データ設計

### 4.1 テーブル構成

詳細は [database-schema.md](../design/database-schema.md) を参照

1. **profiles** - ユーザープロフィール情報
2. **auth_providers** - 認証プロバイダー情報
3. **roles** - 役割マスターデータ
4. **tags** - 技術タグマスターデータ
5. **projects** - プロジェクト情報
6. **project_tags** - プロジェクトとタグの多対多関連

### 4.2 重要な制約

* **user_id**: 4〜20文字、何回でも変更可能、重複チェック付き
* **トークン**: DBに保存せず、セッション管理のみ
* **削除方式**: 論理削除ではなく物理削除
* **外部キー**: CASCADE DELETE で関連データも自動削除

---

## 5. UI / UX 仕様

### 5.1 デザインシステム

#### カラーパレット

* **プライマリー**: #2b6cee（青）
* **テキスト**: #111827（濃いグレー）、#6b7280（ミディアムグレー）
* **背景**: #f8f9fa（ライトグレー）、#ffffff（白）
* **ボーダー**: #e5e7eb（境界線）

#### レイアウト

* **最大幅**: 1400px
* **レスポンシブ**: モバイルファースト設計
* **グリッド**: Tailwind CSS Grid System

#### コンポーネントスタイル

* **カード**: 角丸（rounded-xl）、ボーダー、シャドウ
* **ボタン**: プライマリー（青背景）、セカンダリー（白背景）
* **入力フィールド**: ボーダー、フォーカス時リング表示

### 5.2 インタラクション

* **技術タグ**: チップUI + サジェスト入力
* **役割選択**: チェックボックス（複数選択可）
* **詳細説明**: 自動リサイズテキストエリア
* **プロジェクト登録**: モーダル形式
* **ページネーション**: ページ番号 + 前へ/次へボタン

### 5.3 レスポンシブ対応

#### ブレークポイント

* **モバイル**: ~860px（1カラムレイアウト）
* **タブレット**: 860px~1200px（2〜3カラムレイアウト）
* **デスクトップ**: 1200px~（3〜4カラムレイアウト）

#### 新規プロジェクト追加ボタン

* **1200px以上（デスクトップ）**: ヘッダー内に「新規プロジェクト追加」ボタンを表示
* **1200px未満（タブレット・モバイル）**: 左下にフローティング＋アイコンボタンを表示
* ログイン時のみ表示される

---

## 6. 非機能要件

### 6.1 セキュリティ

* **RLS（Row Level Security）**: 全テーブルで有効化
* **アクセス制御**: 自分の `profile_id` に紐づくデータのみ参照・更新可能
* **トークン管理**: DBに保存せず、セッションのみで管理
* **URL検証**: SNS URLは `https://` または `http://` のみ許可
* **入力検証**: 全てのフォーム入力でバリデーション実施

### 6.2 パフォーマンス

* **ページネーション**: 20件ずつのデータ取得
* **インデックス**: 検索・フィルタリングで使用するカラムにインデックス設定
* **リアルタイム集計**: project_tags テーブルから直接集計（データ量が少ないため問題なし）

### 6.3 可用性

* **ホスティング**: Vercel（99.99% SLA）
* **データベース**: Supabase（自動バックアップ）
* **エラーハンドリング**: 適切なエラーメッセージの表示

### 6.4 保守性

* **マイグレーション**: Supabase migrations でスキーマ管理
* **ドキュメント**: 設計書・API仕様書を整備
* **コード規約**: TypeScript + ESLint + Prettier

---

## 7. 画面一覧

### 7.1 認証関連

1. **ログイン画面** (`/login`)
   * Google / GitHub / Qiita ログインボタン
   * 未認証時は自動リダイレクト

2. **初回登録画面** (`/signup`)
   * user_id 設定フォーム
   * 重複チェック機能

### 7.2 メイン機能

3. **プロジェクト一覧画面** (`/`)
   * プロジェクトカード一覧
   * 検索・フィルタリング機能
   * ソート機能
   * ページネーション
   * 新規プロジェクト追加ボタン
     * デスクトップ（1200px以上）: ヘッダー内に表示
     * タブレット・モバイル（1200px未満）: 左下フローティングボタン

4. **プロジェクト詳細画面** (`/projects/[id]`)
   * プロジェクト情報の詳細表示
   * 編集・削除ボタン

5. **プロジェクト登録・編集モーダル**
   * タイトル、概要、詳細説明入力
   * 期間設定（開始日・終了日）
   * 役割選択（チェックボックス）
   * 技術タグ選択（サジェスト + 複数選択）

### 7.3 プロフィール関連

6. **プロフィール画面** (`/profile`)
   * プロフィールビュー / ダッシュボードビュー切り替え
   * 基本情報表示
   * スキル統計（棒グラフ / グリッド）

7. **設定画面** (`/profile/settings`)
   * タブ切り替え:
     * プロフィール設定
     * 技術タグ管理
     * 認証プロバイダー管理

---

## 8. API 設計

詳細は [02_DB・API設計-20251117.md](02_DB・API設計-20251117.md) を参照

### 8.1 認証 API

* `POST /api/auth/login` - ログイン開始
* `GET /api/auth/callback` - OAuth コールバック
* `POST /api/auth/logout` - ログアウト

### 8.2 プロフィール API

* `GET /api/profile` - プロフィール取得
* `PUT /api/profile` - プロフィール更新
* `PUT /api/profile/user-id` - user_id 変更
* `GET /api/profile/check-user-id` - user_id 重複チェック

### 8.3 プロジェクト API

* `GET /api/projects` - プロジェクト一覧取得
* `POST /api/projects` - プロジェクト作成
* `GET /api/projects/[id]` - プロジェクト詳細取得
* `PUT /api/projects/[id]` - プロジェクト更新
* `DELETE /api/projects/[id]` - プロジェクト削除

### 8.4 タグ API

* `GET /api/tags` - タグ一覧取得
* `POST /api/tags` - タグ作成
* `PUT /api/tags/[id]` - タグ更新
* `DELETE /api/tags/[id]` - タグ削除

### 8.5 役割 API

* `GET /api/roles` - 役割マスター一覧取得

### 8.6 認証プロバイダー API

* `GET /api/auth-providers` - 連携済みプロバイダー一覧
* `POST /api/auth-providers/link` - 新規プロバイダー連携
* `DELETE /api/auth-providers/[id]` - プロバイダー連携解除

### 8.7 スキル統計 API

* `GET /api/skills/stats` - スキル統計取得

---

## 9. 公開ページ（将来拡張）

MVPでは実装しないが、将来的に以下の機能を追加予定:

* `/[user_id]/portfolio` - 公開ポートフォリオページ
* `is_public` フラグによる公開/非公開制御
* プロジェクト単位での公開設定
* OGP画像の自動生成

---

## 10. 運用方針

### 10.1 デプロイ

* **環境**: Vercel（本番環境）
* **CI/CD**: GitHub連携による自動デプロイ
* **環境変数**: Vercel Dashboard で管理

### 10.2 データベース

* **バックアップ**: Supabase 自動バックアップ
* **マイグレーション**: `supabase/migrations/` で管理
* **モニタリング**: Supabase Dashboard

### 10.3 ユーザーサポート

* 管理画面は作成しない
* ユーザー自身のみが自分のデータを管理
* 問い合わせは GitHub Issues で対応

---

## 11. 開発フェーズ

### Phase 1: 基本機能（MVP）✅

* 認証機能
* プロフィール管理
* プロジェクト管理（CRUD）
* 技術タグ管理
* スキル統計表示

### Phase 2: 拡張機能（今後）

* 公開ポートフォリオページ
* Qiita連携
* プロジェクト画像アップロード
* エクスポート機能（PDF / JSON）
* ダークモード対応

### Phase 3: 最適化（今後）

* パフォーマンスチューニング
* SEO最適化
* アクセシビリティ改善
* 多言語対応

---

## 12. 技術的制約・前提条件

### 12.1 Supabase 無料枠の制約

* データベース容量: 500MB
* ストレージ容量: 1GB
* 帯域幅: 5GB/月
* 想定ユーザー数: 10〜100名程度

### 12.2 Vercel 無料枠の制約

* ビルド時間: 月100時間
* 帯域幅: 100GB/月
* サーバーレス関数実行時間: 100時間/月

### 12.3 開発環境

* Node.js: 18.x 以上
* パッケージマネージャー: npm
* エディタ: VS Code（推奨）
* Docker: 開発環境用（docker-compose.dev.yml）

---

## 付録

### 関連ドキュメント

* [database-schema.md](../design/database-schema.md) - データベース設計書
* [02_DB・API設計-20251117.md](02_DB・API設計-20251117.md) - DB・API設計書
* [.claude/CLAUDE.md](../.claude/CLAUDE.md) - プロジェクト概要

### 用語集

* **MVP**: Minimum Viable Product（最小実用製品）
* **RLS**: Row Level Security（行レベルセキュリティ）
* **OAuth**: Open Authorization（オープン認証）
* **CRUD**: Create, Read, Update, Delete
* **OGP**: Open Graph Protocol
