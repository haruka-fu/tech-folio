# ポートフォリオ管理システム 要件定義書（MVP版）

## 1. システム概要

利用者（自分）が自身の案件・使用技術・担当工程を整理するための
**個人向けポートフォリオ管理ダッシュボード**を提供する。

MVPでは公開ページ機能は実装しない。
認証済ユーザーのみが利用する非公開システムとする。

---

## 2. 利用想定・制約

* 利用者数：10〜100名程度
* ホスティング：Vercel
* バックエンド：Next.js（App Router, Route Handlers）
* データベース：Supabase PostgreSQL（無料枠）
* 認証：Supabase Auth（Google / GitHub / Qiita）
* ストレージ：Supabase Storage（プロフィール画像）

---

## 3. 機能一覧

### 3.1 認証機能

* Google / GitHub OAuth を使用してログイン
* 初回ログイン時に `profiles` を自動生成
* `username` が未設定の場合は初回に必須設定

  * 初期値：provider のログインID（取得不可なら空）
  * 英数字 4〜20 文字
  * 重複チェックあり
  * 月 1 回変更可能

### 3.2 プロフィール管理

編集可能項目：

* display_name（必須）
* bio
* job_title
* SNS（GitHub / Qiita / Zenn / その他 1 件）

  * https 始まりのみ許可
* avatar（PNG/JPG/JPEG、2MB まで）

プロフィール画像：

* 上書き保存のみ
* 旧画像はストレージから削除

### 3.3 案件（Projects）管理

項目：

* title（案件名）
* summary（概要）
* 技術タグ（最大 10 件）
* 担当工程（固定選択肢から複数選択）

  * 要件定義
  * 基本設計
  * 詳細設計
  * 開発
  * テスト
  * 運用
  * 保守
* 期間

  * period_start（YYYY-MM-01）
  * period_end（YYYY-MM-01 or null）
  * is_current（true の場合 period_end=null）
* description（最大 500 文字）

表示仕様：

* 無限スクロール（20 件ずつ）
* ソート可能

  * 開始年月降順（デフォルト）
  * 案件名
  * 技術タグ名

---

## 4. 技術タグ管理

仕様：

* ユーザー専用タグ（他ユーザーとは共有しない）
* 1 ユーザー最大 10 タグ
* 1 案件最大 10 タグ
* タグ名は最大 20 文字
* 正規化して保存（小文字化・全角半角統一・trim）

入力：

* サジェスト + 手入力追加
* 不要タグの削除が可能（案件に紐づいている場合は削除不可または警告）

---

## 5. スキル集計

* 技術タグの使用回数を集計し、ユーザーごとに表示
* `profile_skill_stats` にキャッシュ
* 案件 CRUD 時に
  **既存キャッシュ削除 → 全件再計算 → 再保存**

---

## 6. Qiita 連携（任意）

* OAuth によりアクセストークンを取得
* AES-256-GCM で暗号化保存
* 有効期限：30 日
* ダッシュボード上で Qiita 記事一覧を取得・表示（API 毎回フェッチ）

※ 公開ページはないため外部公開はしない。

---

## 7. 公開ページ（MVPでは非対応）

* `/username/public-portfolio` は実装しない
* `is_public` / `visibility_flags` / `previous_username` は将来拡張用に残すが未使用

---

## 8. UI / UX 仕様

* 技術タグ：チップ UI + サジェスト入力
* 担当工程：チェックボックス選択
* description：自動リサイズテキストエリア
* 無限スクロール：20 件単位でロード
* テーマ（ライト/ダーク）は localStorage 保存

---

## 9. 非機能要件

### 9.1 セキュリティ

* すべてのテーブルで RLS 有効
* CRUD は `auth.uid() = profile_id` のデータに限定
* Qiita トークンは AES-256-GCM で暗号化保存
* 暗号鍵は Vercel の環境変数で管理

### 9.2 パフォーマンス

* Supabase 無料枠前提
* 案件上限：1 ユーザーあたり 100 件

### 9.3 信頼性

* トークン期限切れ時は再認証
* ストレージは signed URL を使用

---

## 10. 運用

* 管理画面は作らない
* ユーザー自身のみデータを管理
* 運用は Vercel/Supabase の管理画面で実施
