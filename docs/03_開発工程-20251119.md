# 開発工程 (2025-11-19)

## 概要

Supabase認証を統合し、マルチユーザー対応のポートフォリオアプリケーションを実装する。

## 開発フェーズ

### Phase 1: Supabase認証の基盤構築 ✅

- [x] Supabase設定ファイルの作成 (config.toml, seed.sql)
- [x] データベーススキーマの設計
- [x] Supabaseクライアントの設定 ([lib/supabase.ts](lib/supabase.ts))
- [x] 型定義の整備 (Profile, Project, Tag, Role)

### Phase 2: 認証機能の実装 🔄

- [ ] ログイン画面の作成
  - [ ] `/app/login/page.tsx` の作成
  - [ ] Google OAuth認証の実装
  - [ ] メール/パスワード認証の実装（オプション）
  - [ ] 認証エラーハンドリング
- [ ] 認証状態管理
  - [ ] Auth Contextの作成
  - [ ] 保護されたルートの実装
  - [ ] セッション管理
- [ ] サインアップフロー
  - [ ] 新規ユーザー登録画面
  - [ ] プロフィール初期設定画面

### Phase 3: ルーティングとナビゲーションの再構成 📋

- [ ] ルート構成の変更
  - [ ] `/` → ログイン画面またはダッシュボード（認証状態に応じて）
  - [ ] `/projects` → プロジェクト一覧（現在実装済み）
  - [ ] `/profile` → プロフィール表示
  - [ ] `/profile/settings` → 設定画面
- [x] ナビゲーションの更新
  - [x] [AppHeader.tsx](app/_components/AppHeader.tsx)の認証状態対応
  - [x] ログアウト機能の追加
  - [x] 未認証時のリダイレクト処理
  - [x] レスポンシブ対応（新規追加ボタンの表示切替：1200px基準）

### Phase 4: ユーザー固有データの表示 📊

- [ ] プロジェクト一覧のフィルタリング
  - [ ] [projects/page.tsx](app/projects/page.tsx)の修正
  - [ ] ログインユーザーのprofile_idでフィルタ
  - [ ] RLS (Row Level Security)ポリシーの適用
- [ ] ユーザープロフィール情報の表示
  - [ ] ヘッダーのアバター画像をSupabaseから取得
  - [ ] プロフィール名の動的表示
  - [ ] ユーザー固有の統計情報

### Phase 5: データベースセキュリティ 🔒

- [ ] Row Level Security (RLS) の設定
  - [ ] profilesテーブルのRLSポリシー
  - [ ] projectsテーブルのRLSポリシー
  - [ ] tagsテーブルのRLSポリシー
  - [ ] project_tagsテーブルのRLSポリシー
- [ ] 認証トリガーの設定
  - [ ] 新規ユーザー作成時の自動プロフィール作成
  - [ ] デフォルトロールの割り当て

### Phase 6: UI/UX改善 🎨

- [ ] 認証フロー
  - [ ] ローディング状態の表示
  - [ ] エラーメッセージのトースト通知
  - [ ] 認証リダイレクトのスムーズ化
- [ ] パーソナライゼーション
  - [ ] ウェルカムメッセージ
  - [ ] 初回ログイン時のオンボーディング
  - [ ] 空状態のメッセージ改善

### Phase 7: テストとデバッグ 🧪

- [ ] 認証フローのテスト
  - [ ] ログイン/ログアウト
  - [ ] セッション永続化
  - [ ] トークンリフレッシュ
- [ ] データアクセステスト
  - [ ] ユーザー分離の確認
  - [ ] RLSポリシーの検証
- [ ] エッジケースの処理
  - [ ] ネットワークエラー
  - [ ] セッションタイムアウト
  - [ ] 不正アクセス

## 技術的な実装メモ

### 現在のファイル状態

- ✅ Supabaseクライアント設定: [lib/supabase.ts](lib/supabase.ts)
- ✅ プロジェクト一覧画面: [app/projects/page.tsx](app/projects/page.tsx)
- ✅ ヘッダーコンポーネント: [app/_components/AppHeader.tsx](app/_components/AppHeader.tsx)

### 必要な環境変数 (.env.local)

```env
NEXT_PUBLIC_SUPABASE_URL=your-project-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
```

### データベーステーブル構成

1. `profiles` - ユーザープロフィール情報
2. `projects` - プロジェクト情報（profile_idで関連付け）
3. `tags` - 技術タグ
4. `roles` - 工程・役割
5. `project_tags` - プロジェクトとタグの中間テーブル

## 次のアクション

### 最優先タスク

1. **ログイン画面の作成** (Phase 2)
   - Google OAuth認証の実装
   - リダイレクト処理の設定

2. **認証状態管理** (Phase 2)
   - AuthContextの作成
   - ルート保護の実装

3. **データフィルタリング** (Phase 4)
   - プロジェクト一覧でログインユーザーのデータのみ表示
   - RLSポリシーの適用

## 参考リンク

- [Supabase Auth Documentation](https://supabase.com/docs/guides/auth)
- [Next.js App Router Authentication](https://nextjs.org/docs/app/building-your-application/authentication)
- [Supabase Row Level Security](https://supabase.com/docs/guides/auth/row-level-security)
